!function(R,y){"use strict";var D=ht.AlarmSeverity=function(s,P,A,z,w){this.value=s,this.name=P,this.nickName=A,this.color=z,this.displayName=w};ht.Default.def("ht.AlarmSeverity",y,{toString:function(){return this.displayName||this.name}}),function(){D.severities=new ht.List,D._vm={},D._nm={},D._cp=function(q,k){if(q&&k){var s=q.value-k.value;return s>0?1:0>s?-1:0}return q&&!k?1:!q&&k?-1:0},D.each=function(W,w){D.severities.each(W,w)},D.getSortFunction=function(){return D._cp},D.setSortFunction=function(w){D._cp=w,D.severities.sort(w)},D.add=function(t,L,Z,$,v){var p=new D(t,L,Z,$,v);return D._vm[t]=p,D._nm[L]=p,D.severities.add(p),D.severities.sort(D._cp),p},D.remove=function(K){var v=D._nm[K];return v&&(delete D._nm[K],delete D._vm[v.value],D.severities.remove(v)),v},D.CRITICAL=D.add(500,"Critical","C","#FF0000"),D.MAJOR=D.add(400,"Major","M","#FFA000"),D.MINOR=D.add(300,"Minor","m","#FFFF00"),D.WARNING=D.add(200,"Warning","W","#00FFFF"),D.INDETERMINATE=D.add(100,"Indeterminate","N","#C800FF"),D.CLEARED=D.add(0,"Cleared","R","#00FF00"),D.isClearedAlarmSeverity=function(b){return b?0===b.value:!1},D.getByName=function(c){return D._nm[c]},D.getByValue=function(S){return D._vm[S]},D.clear=function(){D.severities.clear(),D._vm={},D._nm={}},D.compare=function(z,y){return D._cp(z,y)}}();var U=ht.AlarmState=function(N){this._d=N,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",y,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var u=null;for(var m in this._am)m=D.getByName(m),D.isClearedAlarmSeverity(m)||0!==this.getAcknowledgedAlarmCount(m)&&(u=u?D.compare(u,m)>0?u:m:m);this._haa=u},_c2:function(){var u=null;for(var W in this._nm)W=D.getByName(W),D.isClearedAlarmSeverity(W)||0!==this.getNewAlarmCount(W)&&(u=u?D.compare(u,W)>0?u:W:W);this._hna=u},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var r in this._nm)if(r=D.getByName(r),!D.isClearedAlarmSeverity(r)&&0!==this.getNewAlarmCount(r)&&D.compare(this._hna,r)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var U=this._haa,g=this._hna,V=this._ps;this._hoa=U,D.compare(g,this._hoa)>0&&(this._hoa=g),D.compare(V,this._hoa)>0&&(this._hoa=V)},_c5:function(){var Y=this._haa,w=this._hna;this._hta=Y,D.compare(w,this._hta)>0&&(this._hta=w)},increaseAcknowledgedAlarm:function(Z,T){if(0!==T){T=T||1;var X=this._am[Z.name]||0;X+=T,this._am[Z.name]=X,this._f()}},increaseNewAlarm:function(I,h){if(0!==h){h=h||1;var N=this._nm[I.name]||0;N+=h,this._nm[I.name]=N,this._f()}},decreaseAcknowledgedAlarm:function(k,J){if(0!==J){J||(J=1);var W=this._am[k.name]||0;if(W-=J,0>W)throw"Alarm count can not be negative";this._am[k.name]=W,this._f()}},decreaseNewAlarm:function(n,d){if(0!==d){d||(d=1);var G=this._nm[n.name]||0;if(G-=d,0>G)throw"Alarm count can not be negative";this._nm[n.name]=G,this._f()}},acknowledgeAlarm:function(O){this.decreaseNewAlarm(O,1),this.increaseAcknowledgedAlarm(O,1)},acknowledgeAllAlarms:function(h){if(h){var d=this.getNewAlarmCount(h);this.decreaseNewAlarm(h,d),this.increaseAcknowledgedAlarm(h,d)}else for(var J in this._nm)this.acknowledgeAllAlarms(D.getByName(J))},_c6:function(){this._aac=0;for(var F in this._am)F=D.getByName(F),this._aac+=this.getAcknowledgedAlarmCount(F)},getAcknowledgedAlarmCount:function(w){return w?this._am[w.name]||0:this._aac},getAlarmCount:function(h){return this.getAcknowledgedAlarmCount(h)+this.getNewAlarmCount(h)},_c7:function(){this._nac=0;for(var N in this._nm)this._nac+=this.getNewAlarmCount(D.getByName(N))},getNewAlarmCount:function(f){return f?this._nm[f.name]||0:this._nac},setNewAlarmCount:function(L,j){this._nm[L.name]=j,this._f()},removeAllNewAlarms:function(N){N?delete this._nm[N]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(c,B){this._am[c.name]=B,this._f()},removeAllAcknowledgedAlarms:function(K){K?delete this._am[K.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(X){if(this._ep||(X=null),this._ps!==X){var M=this._ps;this._ps=X,this._f(),this._d.fp("propagateSeverity",M,X)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(I){var J=this._ep;this._ep=I,this._d.fp("enablePropagation",J,I)&&(I||this.setPropagateSeverity(null))}});var t=ht.AlarmStatePropagator=function(V){this._dataModel=V,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",y,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(D){this._enable!==D&&(this._enable=D,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(E){this.propagate(E)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(Y){Y.data&&this.propagate(Y.data)},handleDataPropertyChange:function(V){if("alarmState"===V.property||"enablePropagation"===V.property)this.propagate(V.data);else if("parent"===V.property){var X=V.oldValue;X&&this.propagate(X),this.propagate(V.data)}},propagate:function(q){q&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(q),this._isPropagating=!1)},propagateToTop:function(B){for(this.propagateToParent(null,B);B&&B.getParent();)this.propagateToParent(B,B.getParent()),B=B.getParent()},propagateToParent:function(j,n){var Q=null;n.getChildren().each(function(y){var Y=y.getAlarmState().getHighestOverallAlarmSeverity();D.compare(Y,Q)>0&&(Q=Y)}),n.getAlarmState().setPropagateSeverity(Q)}}),ht.AlarmStateStatistics=function(G){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(G)},ht.Default.def("ht.AlarmStateStatistics",y,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(I){var q=this._dataModel;q!==I&&(q&&(q.umd(this.handleDataPropertyChange,this),q.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=I,this.reset(),I.md(this.handleDataPropertyChange,this),I.mm(this.handleDataModelChange,this),this.fp("dataModel",q,I))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(l){"alarmState"===l.property&&(this.increase(l.data),this.fireAlarmStateChange())},handleDataModelChange:function(Q){"add"===Q.kind?(this.increase(Q.data),this.fireAlarmStateChange()):"remove"===Q.kind?(this.decrease(Q.data),this.fireAlarmStateChange()):"clear"===Q.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,D.each(function(A){var J=this.getSumInfo(A);this.sumAcked+=J.ackedCount,this.sumNew+=J.newCount,this.sumTotal+=J.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(C){if(!C)return this.sumNew;var S=this.getSumInfo(C);return S.newCount},getAcknowledgedAlarmCount:function(J){if(!J)return this.sumAcked;var m=this.getSumInfo(J);return m.ackedCount},getTotalAlarmCount:function(e){if(!e)return this.sumTotal;var N=this.getSumInfo(e);return N.totalCount},getSumInfo:function(u){var t=this.severtiyMap[u.name];return t||(t={},t.newCount=0,t.ackedCount=0,t.totalCount=0,this.severtiyMap[u.name]=t),t},decrease:function(d){var l=this.dataMap[d.getId()];l&&(delete this.dataMap[d.getId()],D.each(function(K){var d=l[K.name],T=this.getSumInfo(K);T.newCount=T.newCount-d.newCount,T.ackedCount=T.ackedCount-d.ackedCount,T.totalCount=T.totalCount-d.totalCount},this))},increase:function(A){if(this.decrease(A),!this._filterFunc||this._filterFunc(A)){var J={},M=A.getAlarmState();this.dataMap[A.getId()]=J,D.each(function(D){var Z={};Z.newCount=M.getNewAlarmCount(D),Z.ackedCount=M.getAcknowledgedAlarmCount(D),Z.totalCount=M.getAlarmCount(D),J[D.name]=Z;var N=this.getSumInfo(D);N.newCount=N.newCount+Z.newCount,N.ackedCount=N.ackedCount+Z.ackedCount,N.totalCount=N.totalCount+Z.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(k){var V=this._filterFunc;this._filterFunc=k,this.reset(),this.fp("filterFunc",V,k)},getFilterFunc:function(){return this._filterFunc}});var b=ht.Data.prototype;b.getAlarmState=function(){return this._alarmState||(this._alarmState=new U(this))},b=ht.DataModel.prototype,b.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},b.setEnableAlarmStatePropagator=function(o){o!=this.isEnableAlarmStatePropagator()&&(o?(this._alarmStatePropagator=new t(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},b=ht.graph.GraphView.prototype,b.getNote2=function(u){var k=u.getAlarmState().getHighestNewAlarmSeverity();if(k){var A=u.getAlarmState().getNewAlarmCount(k)+k.nickName;return u.getAlarmState().hasLessSevereNewAlarms()&&(A+="+"),A}return u.s("note2")},b.getNote2Background=function(B){var c=B.getAlarmState().getHighestNewAlarmSeverity();return c?c.color:B.s("note2.background")},b.getBodyColor=function(A){var O=A.getAlarmState().getHighestNativeAlarmSeverity();return O?O.color:A.s("body.color")},b.getBorderColor=function(q){var V=q.getAlarmState().getPropagateSeverity();return V?V.color:q.s("border.color")},b=ht.widget.TreeView.prototype,b.getBorderColor=function(O){var G=O.getAlarmState().getPropagateSeverity();return G?G.color:O.s("border.color")},b.getIcon=function(O){return O.getIcon()?"__alarmIcon__":null},b=ht.widget.TreeTableView.prototype,b.getBorderColor=function(x){var v=x.getAlarmState().getPropagateSeverity();return v?v.color:x.s("border.color")},b.getIcon=function(N){return N.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(h){return h.getIcon()}},color:{func:function(w){var v=w.getAlarmState().getHighestNativeAlarmSeverity();return v?v.color:w.s("body.color")}},rect:[0,0,16,16]}]});var A=ht.Style;A["note2.expanded"]=!0,A["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);