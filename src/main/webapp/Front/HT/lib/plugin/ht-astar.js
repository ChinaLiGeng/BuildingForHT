!function(j,J,l){"use strict";var O=j.ht;O.Astar={},function(g){var c=g();j.AStar=c.astar,j.AStar.Graph=c.Graph}(function(){function n(R){for(var W=R,b=[];W.parent;)b.unshift(W),W=W.parent;return b}function h(){return new p(function(e){return e.f})}function M(i,z){z=z||{},this.nodes=[],this.diagonal=!!z.diagonal,this.grid=[];for(var r=0;r<i.length;r++){this.grid[r]=[];for(var d=0,T=i[r];d<T.length;d++){var b=new o(r,d,T[d]);this.grid[r][d]=b,this.nodes.push(b)}}this.$13x()}function o(L,W,x){this.x=L,this.y=W,this.weight=x}function p(W){this.content=[],this.scoreFunction=W}var l={search:function(_,Q,C,S){_.$6x(),S=S||{};var d=S.heuristic||l.$4x.manhattan,c=S.closest||!1,y=h(),u=Q;for(Q.h=d(Q,C),_.$7x(Q),y.push(Q);y.size()>0;){var g=y.pop();if(g===C)return n(g);g.closed=!0;for(var b=_.neighbors(g),F=0,E=b.length;E>F;++F){var R=b[F];if(!R.closed&&!R.$9x()){var J=g.g+R.getCost(g),q=R.visited;(!q||J<R.g)&&(R.visited=!0,R.parent=g,R.h=R.h||d(R,C),R.g=J,R.f=R.g+R.h,_.$7x(R),c&&(R.h<u.h||R.h===u.h&&R.g<u.g)&&(u=R),q?y.$10x(R):y.push(R))}}}return c?n(u):[]},$4x:{manhattan:function(l,K){var U=Math.abs(K.x-l.x),Y=Math.abs(K.y-l.y);return U+Y},diagonal:function(E,o){var Q=1,z=Math.sqrt(2),g=Math.abs(o.x-E.x),K=Math.abs(o.y-E.y);return Q*(g+K)+(z-2*Q)*Math.min(g,K)}},$5x:function(W){W.f=0,W.g=0,W.h=0,W.visited=!1,W.closed=!1,W.parent=null}};return M.prototype.$13x=function(){this.dirtyNodes=[];for(var b=0;b<this.nodes.length;b++)l.$5x(this.nodes[b])},M.prototype.$6x=function(){for(var a=0;a<this.dirtyNodes.length;a++)l.$5x(this.dirtyNodes[a]);this.dirtyNodes=[]},M.prototype.$7x=function(q){this.dirtyNodes.push(q)},M.prototype.neighbors=function(O){var T=[],Z=O.x,o=O.y,n=this.grid;return n[Z-1]&&n[Z-1][o]&&T.push(n[Z-1][o]),n[Z+1]&&n[Z+1][o]&&T.push(n[Z+1][o]),n[Z]&&n[Z][o-1]&&T.push(n[Z][o-1]),n[Z]&&n[Z][o+1]&&T.push(n[Z][o+1]),this.diagonal&&(n[Z-1]&&n[Z-1][o-1]&&T.push(n[Z-1][o-1]),n[Z+1]&&n[Z+1][o-1]&&T.push(n[Z+1][o-1]),n[Z-1]&&n[Z-1][o+1]&&T.push(n[Z-1][o+1]),n[Z+1]&&n[Z+1][o+1]&&T.push(n[Z+1][o+1])),T},M.prototype.toString=function(){for(var p=[],e=this.grid,B=0;B<e.length;B++){for(var D=[],$=e[B],S=0;S<$.length;S++)D.push($[S].weight);p.push(D.join(" "))}return p.join("\n")},o.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},o.prototype.getCost=function(y){return y&&y.x!=this.x&&y.y!=this.y?1.41421*this.weight:this.weight},o.prototype.$9x=function(){return 0===this.weight},p.prototype={push:function(k){this.content.push(k),this.$11x(this.content.length-1)},pop:function(){var E=this.content[0],x=this.content.pop();return this.content.length>0&&(this.content[0]=x,this.$12x(0)),E},remove:function(V){var T=this.content.indexOf(V),F=this.content.pop();T!==this.content.length-1&&(this.content[T]=F,this.scoreFunction(F)<this.scoreFunction(V)?this.$11x(T):this.$12x(T))},size:function(){return this.content.length},$10x:function(j){this.$11x(this.content.indexOf(j))},$11x:function(B){for(var X=this.content[B];B>0;){var k=(B+1>>1)-1,P=this.content[k];if(!(this.scoreFunction(X)<this.scoreFunction(P)))break;this.content[k]=X,this.content[B]=P,B=k}},$12x:function(E){for(var j=this.content.length,O=this.content[E],A=this.scoreFunction(O);;){var f,S=E+1<<1,b=S-1,G=null;if(j>b){var T=this.content[b];f=this.scoreFunction(T),A>f&&(G=b)}if(j>S){var t=this.content[S],M=this.scoreFunction(t);(null===G?A:f)>M&&(G=S)}if(null===G)break;this.content[E]=this.content[G],this.content[G]=O,E=G}}},{astar:l,Graph:M}});var c=O.Astar.Finder=function(W,g){var P=this;P.gv=W,P.$13x(g),P.refreshMap()};c.prototype={},c.prototype.constructor=c,c.prototype.$13x=function(D){var a=this,E=a.$14x={};D=D||{};var R=D.gridSize||10;E.gridSizeX=D.gridSizeX||R,E.gridSizeY=D.gridSizeY||R,E.rect=D.rect,E.filter=D.filter,E.extendBlocks=D.extendBlocks||3,E.fastOverlap=D.fastOverlap===l?!0:D.fastOverlap,E.nodeRectExtend=D.nodeRectExtend||0,E.diagonal=D.diagonal===l?!0:D.diagonal,E.closest=D.closest===l?!0:D.closest},c.prototype.refreshMap=function(){var g,d=this,K=d.$14x,G=K.gridSizeX,n=K.gridSizeY,c=K.extendBlocks;K.rect?g=K.rect:(g=d.$15x(),O.Default.grow(g,G*c,n*c)),O.Default.grow(g,G,n);var D=Math.floor(g.x/G)*G,A=Math.floor(g.y/n)*n,Y=Math.ceil(g.width/G),j=Math.ceil(g.height/n),x=Y*G,h=j*n;d.$16x={x:D,y:A,w:x,h:h,gridX:G,gridY:n,xLen:Y,yLen:j},d.$17x(),d.$21x()},c.prototype.$15x=function(){var H=this.gv;if(H instanceof O.graph.GraphView)return H.getContentRect();var G,x=O.Default.unionRect;return H.dm().each(function(A){H.isVisible(A)&&A.getRect&&(G=x(G,A.getRect()))}),G},c.prototype.$17x=function(){var Z,H,q,W,J=this,z=J.$16x,E=z.xLen,N=z.yLen;for(Z=new Array(E),q=0;E>q;q++)for(Z[q]=H=new Array(N),W=N;W--;)H[W]=1;var B=J.$14x.filter;for(J.gv.dm().each(function(e){B&&B(e)===!1||(!J._debugInfo||e!==J._debugInfo.grid&&e!=J._debugInfo.path)&&J.$1cw(Z,e)}),q=0;E>q;q++)Z[q][0]=1,Z[q][N-1]=1;for(W=0;N>W;W++)Z[0][W]=1,Z[E-1][W]=1;J.grid=Z;var x=new AStar.Graph(Z,{diagonal:J.$14x.diagonal});J.graph=x},c.prototype.$18x=function(u,o,l,k,D,n,i,A){var x=this.$19x,r=x(l-u,D-i,k-o,n-A);if(1e-6>=r&&r>=-1e-6)return!1;var Q=x(D-u,D-i,n-o,n-A)/r;if(0>Q||Q>1)return!1;var T=x(l-u,D-u,k-o,n-o)/r;return 0>T||T>1?!1:!0},c.prototype.$19x=function(K,j,q,D){return K*D-j*q},c.prototype.$1aw=function(X,P,R,s){for(var h=[-(P[1]-X[1]),P[0]-X[0]],I=h[0]*(R[0]-X[0])+h[1]*(R[1]-X[1])>=0,w=0,L=s.length;L>w;w+=2)if(h[0]*(s[w]-X[0])+h[1]*(s[w+1]-X[1])>=0===I)return!1;return!0},c.prototype.$1bw=function(Y,c){for(var R,j,Q=this,f=0,e=Y.length;e>f;f+=2)if(R=f===e-2?0:f+2,j=R===e-2?0:R+2,Q.$1aw([Y[f],Y[f+1]],[Y[R],Y[R+1]],[Y[j],Y[j+1]],c))return!1;for(var f=0,e=c.length;e>f;f+=2)if(R=f===e-2?0:f+2,j=R===e-2?0:R+2,Q.$1aw([c[f],c[f+1]],[c[R],c[R+1]],[c[j],c[j+1]],Y))return!1;return!0},c.prototype.$1cw=function(K,e){if(e.getRect){var G=this,z=e.getRect();O.Default.grow(z,G.$14x.nodeRectExtend);var i,g,v,W,R,S,_,t,k,x,U,l=G.$1dw({x:z.x,y:z.y}),c=G.$1dw({x:z.x+z.width,y:z.y+z.height}),n=G.$14x.fastOverlap;if(!n){var s=e.getCorners();_=[],s.forEach(function(m){_.push(m.x,m.y)}),x=G.$14x.gridSizeX/2,U=G.$14x.gridSizeY/2}for(g=Math.max(0,l.x),v=Math.min(c.x,K.length-1),R=Math.max(0,l.y),S=Math.min(c.y,K.length?K[0].length-1:-1),i=g;v>=i;i++)for(W=R;S>=W;W++)if(n)K[i][W]=0;else{k=G.$1ew({x:i,y:W});var D=k.x-x,T=k.x+x,p=k.y-U,P=k.y+U;t=[D,p,D,P,T,P,T,p],G.$1bw(_,t)&&(K[i][W]=0)}}},c.prototype.$1dw=function(Z,z){var B=this,o=B.$16x,A=(Z.x-o.x)/o.gridX,S=(Z.y-o.y)/o.gridY;return z!==!1&&(A=Math.round(A),S=Math.round(S)),{x:A,y:S}},c.prototype.$1ew=function(e){var R=this,j=R.$16x;return{x:e.x*j.gridX+j.x,y:e.y*j.gridY+j.y}},c.prototype.$1fw=function(K){var y=this,i=y.$16x,o=i.xLen,r=i.yLen;if(K.x>=0&&K.x<o&&K.y>=0&&K.y<r)return K;var Q={x:K.x,y:K.y};return Q.x<0?Q.x=0:Q.x>=o&&(Q.x=o-1),Q.y<0?Q.y=0:Q.y>=r&&(Q.y=r-1),Q},c.prototype.findPath=function(Z,d){var k,S,F,g,v=this,e=v.$1dw(Z),E=v.$1dw(d);if(F=v.$1fw(e),g=v.$1fw(E),F!==e&&g!==E){var m=v.$16x,Y=m.x-m.gridX/2,Q=m.y-m.gridY/2,p=Y+m.gridX*m.xLen,z=Q+m.gridY*m.yLen;if(!(v.$18x(Z.x,Z.y,d.x,d.y,Y,Q,p,Q)||v.$18x(Z.x,Z.y,d.x,d.y,p,Q,p,z)||v.$18x(Z.x,Z.y,d.x,d.y,p,z,Y,z)||v.$18x(Z.x,Z.y,d.x,d.y,Y,z,Y,Q)))return[Z,d]}F!==e&&(k=!0,e=F),g!==E&&(S=!0,E=g);var R=v.graph.grid[e.x][e.y],L=v.graph.grid[E.x][E.y],q=AStar.search(v.graph,R,L,{closest:v.$14x.closest});if(!q||!q.length)return null;var N=[];N.push(Z),k&&N.push(v.$1ew(q[0]));for(var b=1,h=q.length;h-1>b;b++)N.push(v.$1ew(q[b]));if(S)N.push(v.$1ew(q[h-1])),N.push(d);else{var U=q[h-1];E.x===U.x&&E.y===U.y?N.push(d):N.push(v.$1ew(U))}return v.$20x=N,v.$21x(),N},c.prototype.debugOn=function(h){this.debugFlag=!0,this.debugSettings=h||{},this.$21x()},c.prototype.$21x=function(){var C=this;if(C.$22x(),this.debugFlag){var p=C.grid;if(p){var U;if(C.debugSettings.$16x!==!1){U=[];for(var P,j,f,q,n,l=[],k=C.$14x.gridSizeX/2,_=C.$14x.gridSizeY/2,e=p.length,S=e?p[0].length:0,Q=1;e-1>Q;Q++)for(var g=1;S-1>g;g++)p[Q][g]||(P=C.$1ew({x:Q,y:g}),j=P.x-k,f=P.x+k,q=P.y-_,n=P.y+_,U.push({x:j,y:q},{x:j,y:n},{x:f,y:n},{x:f,y:q}),l.push(1,2,2,2,5));var R=new O.Shape;R.s("shape.border.color","rgba(50, 50, 50, 0.2)"),R.s("shape.border.width",1),R.s("shape.background","rgba(200, 50, 100, 0.2)"),R.s("2d.editable",!1),R.s("2d.selectable",!1),R.setPoints(U),R.setSegments(l),C._debugInfo={grid:R},gv.dm().add(R)}C.debugSettings.path!==!1&&(U=new O.Shape,C.$20x&&(U.setPoints(C.$20x),U.s("shape.border.color","red"),U.s("shape.border.width",1),U.s("2d.editable",!1),U.s("2d.selectable",!1),U.s("shape.background",null),C._debugInfo||(C._debugInfo={}),C._debugInfo.path=U,gv.dm().add(U)))}}},c.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},c.prototype.$22x=function(){var $=this;if($._debugInfo){var l=$._debugInfo.grid,h=$._debugInfo.path;l&&gv.dm().remove(l),h&&gv.dm().remove(h),$._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);