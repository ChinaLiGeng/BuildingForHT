!function(c,P){"use strict";var m="ht",r=m+".layout.",h=c[m]||module.parent.exports.ht,Z=h.List,X=h.DataModel,V=h.Node,u=h.Edge,C=h.Group,w=Math,$=w.sqrt,M=w.random,N=w.max,y=w.min,L=function(u){return u*u};h.Default.getInternal().addMSMap({ms_force:function(d){d._interval=50,d._stepCount=10,d._motionLimit=.01,d._edgeRepulsion=.65,d._nodeRepulsion=.65,d._damper=1,d._maxMotion=0,d._motionRatio=0,d.init=function(g){var z=this;g instanceof X?z.dm=g:z.gv=g,z._nodeMap={},z._nodes=new Z,z._edges=new Z},d.start=function(){var k=this,X=k.gv;if(!k._timer){var e=k.cdm=X?X.dm():k.dm;e.mm(k.handleDataModelChange,k),e.md(k.handleDataPropertyChange,k),X&&X.mp(k.handleGV,k),e.each(function(J){if(k.isVisible(J)&&k.isLayoutable(J)&&J instanceof V)if(k instanceof f){var u=J.p3();J.p3([u[0]+M(),u[1]+M(),u[2]+M()])}else u=J.p(),J.p(u.x+M(),u.y+M())}),k._timer=setInterval(function(){k.relax()},k._interval),k._damper=1}},d.stop=function(){var P=this;P._timer&&(P.cdm.umm(P.handleDataModelChange,P),P.cdm.umd(P.handleDataPropertyChange,P),P.gv&&P.gv.ump(P.handleGV,P),clearInterval(P._timer),delete P._timer,delete P.cdm)},d.handleGV=function(l){var r=this;if("dataModel"===l.property){var M=l.oldValue,E=l.newValue;M&&(M.umm(r.handleDataModelChange,r),M.umd(r.handleDataPropertyChange,r)),this.cdm=E,E.mm(r.handleDataModelChange,r),E.md(r.handleDataPropertyChange,r)}},d.relax=function(){var r=this;if(!(r._damper<.1&&r._maxMotion<r._motionLimit)){this.cdm.each(function(g){r.isVisible(g)&&(g instanceof u?r.addEdge(g):g instanceof V&&r.addNode(g))});for(var D,d,O=0,W=r._edges,b=r._nodes,G=b.size();O<r._stepCount;O++){for(W.each(r.relaxEdge,r),D=0;G>D;D++)for(d=0;G>d;d++)r.relaxNode(b.get(D),b.get(d));r.moveNode()}r._isAdjusting=1,b.each(function(h){h.fix||(h.p?h.v.p3(h.p):h.v.p(h.x,h.y))}),delete r._isAdjusting,r._nodeMap={},b.clear(),W.clear(),r.onRelaxed()}},d.onRelaxed=function(){},d.isRunning=function(){return!!this._timer},d.isVisible=function(B){return B.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(B):!0},d.isLayoutable=function(Z){if(Z.s("layoutable")===!1)return!1;if(Z instanceof C)return!1;var Q=this;return Q.gv?Q.gv.isMovable(Z)&&!Q.gv.isSelected(Z):!(Q.cdm||Q.dm).sm().co(Z)},d.getNodeRepulsion=function(){return this._nodeRepulsion},d.setNodeRepulsion=function(R){this._nodeRepulsion=R,this._damper=1},d.getEdgeRepulsion=function(){return this._edgeRepulsion},d.setEdgeRepulsion=function(R){this._edgeRepulsion=R,this._damper=1},d.getStepCount=function(){return this._stepCount},d.setStepCount=function(U){this._stepCount=U,this._damper=1},d.getInterval=function(){return this._interval},d.setInterval=function(R){var H=this;H._interval!==R&&(H._interval=R,H._timer&&(clearInterval(H._timer),H._timer=setInterval(function(){H.relax()},R)))},d.handleDataPropertyChange=function(J){!this._isAdjusting&&this.isVisible(J.data)&&(this._damper=1)},d.handleDataModelChange=function(){this._damper=1},d.damp=function(){var A=this._maxMotion,B=this._damper;this._motionRatio<=.001&&((.2>A||A>1&&.9>B)&&B>.01?this._damper-=.01:.4>A&&B>.003?this._damper-=.003:B>1e-4&&(this._damper-=1e-4)),A<this._motionLimit&&(this._damper=0)}}}),h.layout.ForceLayout=function(J){this.init(J)},h.Default.def(r+"ForceLayout",P,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(E){this._limitBounds=E,this._damper=1},getNodeSize:function(x){var f=this.gv;return f&&f.getDataUIBounds?f.getDataUIBounds(x):x.getRect()},addNode:function(W){var j=this,e=j._nodeMap[W._id];if(e)return e;var P=W.p();e={v:W,x:P.x,y:P.y,dx:0,dy:0,fix:!j.isLayoutable(W),s:j.getNodeSize(W)};var u=e.s,C=$(L(u.width)+L(u.height))*j._nodeRepulsion;return e.r=1>C?100:C,j._nodeMap[W._id]=e,j._nodes.add(e),e},addEdge:function(L){if(L._40I&&L._41I){var f=this,E=f.addNode(L._40I),v=f.addNode(L._41I),H={s:E,t:v};v=v.s,E=E.s;var l=v.width+E.width,h=v.height+E.height;H.length=$(l*l+h*h)*f._edgeRepulsion,H.length<=0&&(H.length=100),f._edges.add(H)}},relaxEdge:function(D){var u=D.t,U=D.s,M=u.x-U.x,b=u.y-U.y,P=$(M*M+b*b),g=100*D.length,p=.25*M/g*P,m=.25*b/g*P;u.dx=u.dx-p,u.dy=u.dy-m,U.dx=U.dx+p,U.dy=U.dy+m},relaxNode:function(c,v){if(c!==v){var i=0,w=0,r=c.x-v.x,p=c.y-v.y,J=r*r+p*p;0===J?(i=M(),w=M()):36e4>J&&(i=r/J,w=p/J);var b=c.r*v.r/400;i*=b,w*=b,c.dx+=i,c.dy+=w,v.dx-=i,v.dy-=w}},moveNode:function(){var u=this,D=u._limitBounds,q=u._maxMotion,b=0,F=u._damper;u._nodes.each(function(i){if(!i.fix){var V=i.dx*F,q=i.dy*F;if(i.dx=V/2,i.dy=q/2,b=N($(V*V+q*q),b),i.x+=N(-40,y(40,V)),i.y+=N(-40,y(40,q)),D){i.x<D.x&&(i.x=D.x,u.adjust(1,0)),i.y<D.y&&(i.y=D.y,u.adjust(0,1));var a=i.s;i.x+a.width>D.x+D.width&&(i.x=D.x+D.width-a.width,u.adjust(-1,0)),i.y+a.height>D.y+D.height&&(i.y=D.y+D.height-a.height,u.adjust(0,-1))}}}),u._maxMotion=b,u._motionRatio=b>0?q/b-1:0,u.damp()},adjust:function(i,J){var f=this._limitBounds;this._nodes.each(function(H){i>0?(!f||H.x+H.s.width+i<f.x+f.width)&&(H.x+=i):(!f||H.x+i>f.x)&&(H.x+=i),J>0?(!f||H.y+H.s.height+J<f.y+f.height)&&(H.y+=J):(!f||H.y+J>f.y)&&(H.y+=J)})}});var f=h.layout.Force3dLayout=function(e){this.init(e)};h.Default.def(r+"Force3dLayout",P,{ms_force:1,getNodeSize3d:function(L){return L.s3()},addNode:function(C){var z=this,K=z._nodeMap[C._id];if(K)return K;K={v:C,p:C.p3(),d:[0,0,0],fix:!z.isLayoutable(C),s:z.getNodeSize3d(C)};var I=K.s,l=h.Default.getDistance(I)*z._nodeRepulsion;return K.r=1>l?100:l,z._nodeMap[C._id]=K,z._nodes.add(K),K},addEdge:function(O){if(O._40I&&O._41I){var d=this,N=d.addNode(O._40I),k=d.addNode(O._41I),Q={s:N,t:k};k=k.s,N=N.s,Q.length=$(L(k[0]+N[0])+L(k[1]+N[1])+L(k[2]+N[2]))*d._edgeRepulsion,Q.length<=0&&(Q.length=100),d._edges.add(Q)}},relaxEdge:function(V){var e=V.t.p,F=V.s.p,O=V.t.d,N=V.s.d,W=e[0]-F[0],c=e[1]-F[1],P=e[2]-F[2],X=$(W*W+c*c+P*P),K=100*V.length,m=.25*W/K*X,T=.25*c/K*X,g=.25*P/K*X;O[0]-=m,O[1]-=T,O[2]-=g,N[0]+=m,N[1]+=T,N[2]+=g},relaxNode:function(P,k){if(P!==k){var r=P.p,L=k.p,u=0,q=0,y=0,U=r[0]-L[0],V=r[1]-L[1],W=r[2]-L[2],h=U*U+V*V+W*W;0===h?(u=M(),q=M(),y=M()):216e6>h&&(u=U/h,q=V/h,y=W/h);var R=P.r*k.r/400,i=P.d,Y=k.d;u*=R,q*=R,y*=R,i[0]+=u,i[1]+=q,i[2]+=y,Y[0]-=u,Y[1]-=q,Y[2]-=y}},moveNode:function(){var k=this,z=k._maxMotion,t=0,q=k._damper;k._nodes.each(function(z){if(!z.fix){var w=z.p,_=z.d,n=_[0]*q,m=_[1]*q,H=_[2]*q;_[0]=n/2,_[1]=m/2,_[2]=H/2,t=N($(n*n+m*m+H*H),t),w[0]+=N(-40,y(40,n)),w[1]+=N(-40,y(40,m)),w[2]+=N(-40,y(40,H))}}),k._maxMotion=t,k._motionRatio=t>0?z/t-1:0,k.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);